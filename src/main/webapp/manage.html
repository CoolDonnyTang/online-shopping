<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->

<title>管理员页面</title>

<!-- Bootstrap -->
<link href="resources/plugins/bootstrap/css/bootstrap.min.css"
	rel="stylesheet">
<link href="resources/my-css/manage.css" rel="stylesheet">
<link href="resources/my-css/user-base.css" rel="stylesheet">
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-1">
				<h4>内部管理</h4>
			</div>
		</div>
		<hr/>
		<div class="row">
			<div class="col-md-2">
				<ul class="list-group" id="managerList">
				  <li class="list-group-item list-1">分类管理</li>
				  <li class="list-group-item list-1">添加商品</li>
				  <li class="list-group-item list-1">Morbi leo risus</li>
				  <li class="list-group-item list-1">Porta ac consectetur ac</li>
				  <li class="list-group-item list-1">Vestibulum at eros</li>
				</ul>
			</div>
			<div class="col-md-10 content" >
				<!-- 分类管理 -->
				<div class="kinds-content" id="kinds_content" style="display: none;">
					<ul class="nav nav-tabs" id="kinds_operate">
					  <li role="presentation" class="list-2"><a>添加主分类</a></li>
					  <li role="presentation" class="list-2"><a>添加子分类</a></li>
					  <li role="presentation" class="list-2"><a>删除主分类</a></li>
					  <li role="presentation" class="list-2"><a>删除子分类</a></li>
					</ul>
					<!-- 添加主分类 -->
					<div class="operate-content col-md-12" id="add_main">
						<div class="form-group">
						    <label for="main-kinds">主分类输入</label>
						    <input type="text" class="form-control" id="main-kinds">
						</div>
						<div class="form-group">
						    <label for="subsidiary_kinds1">从分类输入</label>
						    <textarea class="form-control" id="subsidiary_kinds1" rows="3"></textarea>
						</div>
						<button type="button" class="btn btn-danger col-md-2" id="sub_main">提交</button>
					</div>
					<!-- 添加从分类 -->
					<div class="operate-content col-md-12" id="add_subsidiary">
						<div class="form-group">
						    <label for="main_kinds_l1">选择主分类</label>
						    <select class="form-control" id="main_kinds_l1">
							  <option>1</option>
							  <option>2</option>
							  <option>3</option>
							  <option>4</option>
							  <option>5</option>
							</select>
						</div>
						<div class="form-group">
						    <label for="subsidiary_kinds2">从分类输入</label>
						    <textarea class="form-control" id="subsidiary_kinds2" rows="3"></textarea>
						</div>
						<button type="button" class="btn btn-danger col-md-2" id="submitSubKind">提交</button>
					</div><!--  -->
					<!-- 删除主分类 -->
					<div class="operate-content col-md-12" id="delete_main">
						<div class="form-group">
						    <label for="main_kinds_l2">删除主分类</label>
						    <select class="form-control" id="main_kinds_l2">
							  
							</select>
						</div>
						<button type="button" class="btn btn-danger col-md-2" id="deleteMain">删除</button>
					</div><!--  -->
					<!-- 删除从分类 -->
					<div class="operate-content col-md-12" id="delete_subsidiary">
						<div class="form-group">
						    <label for="main_kinds_l3">选择主分类</label>
						    <select class="form-control" id="main_kinds_l3">
							  
							</select>
						</div>
						<div class="form-group">
						    <label for="subsidiary_kinds3">删除从分类</label>
						    <select class="form-control" id="subsidiary_kinds3">
							  
							</select>
						</div>
						<button type="button" class="btn btn-danger col-md-2">删除</button>
					</div><!--  -->
				</div><!--分类管理结束 -->
				<!-- 添加商品开始 -->
				<div class="kinds-content" id="commodityContent">
					<ul class="nav nav-tabs" id="commodityOperateList">
					  <li role="presentation" class="list-2"><a>添加商品模板</a></li>
					  <li role="presentation" class="list-2"><a>添加商品实体</a></li>
					</ul>
					<!-- 添加商品模板开始 -->
					<div id="addCommodityModel" class="operate-content" style="display: none;">
						<form action="manage/addCommodity.action"  id="commodityMessage" method="post" enctype="multipart/form-data">
							<div class="form-group">
							    <label for="commodityTitle">商品标题</label>
							    <input type="text" class="form-control" id="commodityTitle" name="titleName">
							</div>
							<hr>
							<div class="form-group">
							    <label for="commodityMainKinds">所属主类别</label>
							    <select class="form-control" id="commodityMainKinds">
								  <option>A</option>
								  <option>B</option>
								  <option selected="selected">C</option>
								</select>
							</div>
							<div class="form-group">
							    <label for="commoditySubKinds">所属子类别</label>
							    <select class="form-control" id="commoditySubKinds" name="belongKindId">
								  <option>1</option>
								  <option>2</option>
								  <option>3</option>
								</select>
							</div>
							<hr>
							<div class="form-group">
							    <label for="property1">属性一</label>
							    <input type="text" class="form-control" id="property1" name="property1">
							</div>
							<div class="form-group">
							    <label for="property1Detail">属性一详情</label>
							    <textarea class="form-control" id="property1Detail" rows="3" name="property1Content"></textarea>
							</div>
							<hr>
							<div class="form-group">
							    <label for="property2">属性二</label>
							    <input type="text" class="form-control" id="property2" name="property2">
							</div>
							<div class="form-group">
							    <label for="property2Detail">属性二详情</label>
							    <textarea class="form-control" id="property2Detail" rows="3" name="property2Content"></textarea>
							</div>
							<hr>
							<div class="form-group">
							    <label for="brand">所属品牌</label>
							    <input type="text" class="form-control" id="brand" name="brand">
							</div>
							<hr>
							<div class="form-group" id="detailImageList">
							    <label for="detailImage1">商品详情图片</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage2">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage3">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage4">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage5">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage6">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage7">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage8">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage9">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <label class="sr-only" for="detailImage10">File input</label>
							    <input type="file" name="file" class="detailImage">
							    <p class="help-block">请上传1200x560像素比例图片最佳</p>
							</div>
						</form>
						<button type="button" class="btn btn-danger col-md-3" id="submitCommodityMessage">提交</button>
					</div><!-- 添加商品模板结束 -->
					<!-- 添加商品实体开始 -->
					<div id="addCommodityEntity"  class="operate-content" style="display: none;">
						<form method="post" enctype="multipart/form-data" id="commEntityForm">
							<div class="form-group">
							    <label for="commEntityMainKinds">所属主类别</label>
							    <select class="form-control" id="commEntityMainKinds">
								  <option>A</option>
								  <option>B</option>
								  <option selected="selected">C</option>
								</select>
							</div>
							<div class="form-group">
							    <label for="commEntitySubKinds2">所属子类别</label>
							    <select class="form-control" id="commEntitySubKinds2">
								  <option>1</option>
								  <option>2</option>
								  <option>3</option>
								</select>
							</div>
							<hr>
							<div class="form-group">
							    <label for="commEntityBrand">品牌</label>
							    <select class="form-control" id="commEntityBrand">
								  <option selected="selected">1</option>
								  <option>2</option>
								  <option>3</option>
								</select>
							</div>
							<hr>
							<div class="form-group">
							    <label for="commEntityBrand">商品标题</label>
							    <select class="form-control" id="commEntityTitle" name="belongCommId">
								  <option selected="selected">1</option>
								  <option>2</option>
								  <option>3</option>
								</select>
							</div>
							<hr>
							<div class="form-group">
							    <label for="commEntityProp1" id="popLable1">属性一</label>
							    <select class="form-control" id="commEntityProp1">
								  <option>1</option>
								  <option>2</option>
								  <option>3</option>
								</select>
							</div>
							<div class="form-group">
							    <label for="commEntityProp2" id="popLable2">属性二</label>
							    <select class="form-control" id="commEntityProp2">
								  <option>1</option>
								  <option>2</option>
								  <option>3</option>
								</select>
							</div>
							<hr>
							<div class="form-group">
							    <label for="commEntityInventory">库存</label>
							    <input type="text" class="form-control" id="commEntityInventory" name="inventory">
							</div>
							<div class="form-group">
							    <label for="myPrice">销售价</label>
							    <input type="text" class="form-control" id="myPrice" name="myPrice">
							</div>
							<div class="form-group">
							    <label for="marketPrice">市场价</label>
							    <input type="text" class="form-control" id="marketPrice" name="marketPrice">
							</div>
							<hr>
							<div class="form-group">
							    <label for="paramDetail">参数详情</label>
							    <textarea class="form-control" id="paramDetail" rows="3" name="paramss"></textarea>
							</div>
							<hr>
							<div class="form-group" id="mainImageList">
								<label for="mainImage1">商品主图片</label>
							    <input type="file" name="file" class="mainImage">
							    <label class="sr-only" for="mainImage2">File input</label>
							    <input type="file" name="file" class="mainImage">
							    <label class="sr-only" for="mainImage3">File input</label>
							    <input type="file" name="file" class="mainImage">
							    <label class="sr-only" for="mainImage4">File input</label>
							    <input type="file" name="file" class="mainImage">
							    <p class="help-block">请上传380x460像素比例图片</p>
							</div>
						</form>
						<button type="button" class="btn btn-danger col-md-3" id="submitCommEntityMessage">提交</button>
					</div><!-- 添加商品实体结束 -->
				</div><!-- 添加商品结束 -->
			</div>
		</div>
		<hr/>
		<div class="page-copyright text-center">
			Copyright &copy; 2017 <strong>爱购商城i-go.shop</strong> 版权所有
		</div>
	</div>
	<script src="resources/plugins/jquery-2.2.4.min.js"></script>
	<script src="resources/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="resources/scripts/my-utils.js"></script>
	<script type="text/javascript" src="resources/scripts/manage/manage.js"></script>
	<script type="text/javascript">
		$(function() {
			//主操作列表点击事件
			$("#managerList").click(function(event) {
				var $target = $(event.target);
				switch($target.text().trim())
				{
				case "分类管理":
					disManageList(1);
				  	break;
				case "添加商品":
					disManageList(2);
					break;
				}
			});
			//类操作事件
			$("#kinds_operate").click(function(event){
				var $target = $(event.target);
				if(event.target.nodeName === "A") {
					$("#kinds_operate").children("li").removeClass("active");
					$target.parent().addClass("active");
				}
				switch($target.text().trim())
				{
				case "添加主分类":
				  	operKindsDis(1);
				  	break;
				case "添加子分类":
					//发送请求加载主分类
					$.ajax({
						data:"",
						dataType:"json",
						error:function() {
							alert("连接服务器失败");
						},
						success:function(result) {
							if(result.status === 1) {
								var data = result.data;
console.log(data);
								//清空原来列表
								$("#main_kinds_l1").html("");
								for(var i=0; i<data.length; i++) {
									var $option = $("<option>" +data[i].kindName + "</option>");
									$option.data("id", data[i].id);
									$("#main_kinds_l1").append($option);
									//提交可点
									$("#submitSubKind").removeAttr("disabled");
								}
							} else {
								alert(result.info);
								//提交按钮不可点
								$("#submitSubKind").attr("disabled", "disabled");
							}
						},
						type:"post",
						url:"manage/findMain.action"
					});
				 	operKindsDis(2);
				  	break;
				case "删除主分类":
					//发送请求加载主分类
					$.ajax({
						data:"",
						dataType:"json",
						error:function() {
							alert("连接服务器失败");
						},
						success:function(result) {
							if(result.status === 1) {
								var data = result.data;
								//清空原来列表
								$("#main_kinds_l2").html("");
								for(var i=0; i<data.length; i++) {
									var $option = $("<option>" +data[i].kindName + "</option>");
									$option.data("id", data[i].id);
									$("#main_kinds_l2").append($option);
									//删除可点
									$("#deleteMain").removeAttr("disabled");
								}
							} else {
								alert(result.info);
								//删除按钮不可点
								$("#deleteMain").attr("disabled", "disabled");
							}
						},
						type:"post",
						url:"manage/findMain.action"
					});
				  	operKindsDis(3);
				  	break;
				case "删除子分类":
				  	operKindsDis(4);
				  	break;
				}
			});
			//提交新建主类事件
			$("#sub_main").click(function(){
				var mainText = $("#main-kinds").val().trim();
				var subText = $("#subsidiary_kinds1").val().trim();
				if(""===mainText || ""===subText) {
					alert("主类和子类均不可为空");
					return;
				}
				$.ajax({
					data:{mainName:mainText,subName:subText},
					dataType:"json",
					error:function() {
						alert("连接服务器失败");
					},
					success:function(result) {
						if(result.status === 1) {
							$("#main-kinds").val("");
							$("#subsidiary_kinds1").val("");
							alert("添加成功");
						} else {
							alert(result.info);
						}
					},
					type:"post",
					url:"manage/addMainKind.action"
				});
			});
			//提交辅类提交事件
			$("#submitSubKind").click(function() {
				var subText = $("#subsidiary_kinds2").val().trim();
				var mainId = $("#main_kinds_l1 option:selected").data("id");
				if(subText === "" || undefined=== mainId) {
					alert("输入有误或操作非法");
					return;
				}
				$.ajax({
					data:{mainId:mainId,subName:subText},
					dataType:"json",
					error:function() {
						alert("连接服务器失败");
					},
					success:function(result) {
						if(result.status === 1) {
							$("#subsidiary_kinds2").val("");
							alert("添加成功");
						} else {
							alert(result.info);
						}
					},
					type:"post",
					url:"manage/addSubKind.action"
				});
			});
			//删除主类事件
			$("#deleteMain").click(function() {
				var mainId = $("#main_kinds_l2 option:selected").data("id");
				if(undefined=== mainId) {
				alert("不可执行该操作");
					return;
				}
				$.ajax({
					data:{mainId:mainId},
					dataType:"json",
					error:function() {
						alert("连接服务器失败");
					},
					success:function(result) {
						if(result.status === 1) {
							alert("删除成功");
						} else {
							alert(result.info);
						}
					},
					type:"post",
					url:"manage/deleteMain.action"
				});
			});
			/**
			 * 添加商品相关js
			 **/
			//切换添加商品模板和添加商品实体
			$("#commodityOperateList").click(function(event) {
				var $target = $(event.target);
//alert(event.target.nodeName);
				if(event.target.nodeName === "A") {
					$("#commodityOperateList").children("li").removeClass("active");
					$target.parent().addClass("active");
				}
				switch($target.text().trim())
				{
				case "添加商品模板":
					//发送请求加载分类
					$.ajax({
						data:"",
						dataType:"json",
						error:function() {
							alert("分类加载失败");
						},
						success:function(result) {
							if(result.status === 1) {
								var data = result.data;
								//清空列表
								$("#commodityMainKinds option").remove();
								for(var i=0; i<data.length; i++) {
									var $option;
									if(i===0) {
										$option = $("<option selected='selected' value="+ data[i].id +">"+data[i].kindName+"</option>");
										//清空列表
										$("#commoditySubKinds option").remove();
										for(var j=0; j<data[i].subKinds.length; j++) {
											var $option2 ;
											if(j === 0) {
												$option2 = $("<option selected='selected' value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
											} else {
												$option2 = $("<option value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
											}
											$("#commoditySubKinds").append($option2);
										}
									} else {
										$option = $("<option value="+ data[i].id +">"+data[i].kindName+"</option>");
									}
									$("#commodityMainKinds").data("data", data);
									$("#commodityMainKinds").append($option);
								} 
							}else {
									
							}
						},
						type:"post",
						url:"manage/findMain.action",
					});
					$("#addCommodityModel").show();
					$("#addCommodityEntity").hide();
				  	break;
				case "添加商品实体":
					//发送请求加载分类
					$.ajax({
						data:"",
						dataType:"json",
						error:function() {
							alert("分类加载失败");
						},
						success:function(result) {
							if(result.status === 1) {
								var data = result.data;
								//清空列表
								$("#commEntityMainKinds option").remove();
								for(var i=0; i<data.length; i++) {
									var $option;
									if(i===0) {
										$option = $("<option selected='selected' value="+ data[i].id +">"+data[i].kindName+"</option>");
										//清空列表
										$("#commEntitySubKinds2 option").remove();
										for(var j=0; j<data[i].subKinds.length; j++) {
											var $option2 ;
											if(j === 0) {
												$option2 = $("<option selected='selected' value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
											} else {
												$option2 = $("<option value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
											}
											$("#commEntitySubKinds2").append($option2);
										}
									} else {
										$option = $("<option value="+ data[i].id +">"+data[i].kindName+"</option>");
									}
									$("#commEntityMainKinds").data("data", data);
									$("#commEntityMainKinds").append($option);
								}
								/**
								*	加载模板默认信息
								*/
								//子分类下拉选的值
								var subKindId = $("#commEntitySubKinds2 option:selected").val();
								$.ajax({
									data:{"subKindId":subKindId},
									dataType:"json",
									error:function(){
										alert("连接服务器失败");
									},
									success:function(result){
										if(result.status === 1) {
											var data = result.data;
											if(data.length<=0) {
												alert("当前分类下未建立商品模板");
												return;
											}
											//清空品牌下拉选
											$("#commEntityBrand option").remove();
											for(var i=0; i<data.length; i++) {
												var $option ;
												if(i === 0) {
													$option = $("<option selected='selected'>"+ data[i].brandName +"</option>");
												} else {
													$option = $("<option>"+ data[i].brandName +"</option>");
												}
												$("#commEntityBrand").append($option);
												$("#commEntityBrand").data("data", data);
											}
											//清空商品标题下拉选
											$("#commEntityTitle option").remove();
											for(var j=0; j<data[0].commTitles.length; j++) {
												var $titleOption ;
												if(j === 0) {
													$titleOption = $("<option selected='selected' value="+ data[0].commTitles[j].commId +">" + data[0].commTitles[j].commTitle +"</option>");
												} else {
													$titleOption = $("<option value="+ data[0].commTitles[j].commId +">" + data[0].commTitles[j].commTitle +"</option>");
												}
												$("#commEntityTitle").append($titleOption);
											}
											/**
											*	初始化属性下拉选
											*/
											$("#popLable1").text(data[0].commTitles[0].prop1.propName);
											//清空属性一下拉选
											$("#commEntityProp1 option").remove();
											for(var p1=0; p1<data[0].commTitles[0].prop1.props.length; p1++) {
												var $prop1Option ;
												if(p1 === 0) {
													$prop1Option = $("<option selected='selected'>" + data[0].commTitles[0].prop1.props[p1] +"</option>");
												} else {
													$prop1Option = $("<option>" + data[0].commTitles[0].prop1.props[p1] +"</option>");
												}
												$("#commEntityProp1").append($prop1Option);
											}
											$("#popLable2").text(data[0].commTitles[0].prop2.propName);
											//清空属性一下拉选
											$("#commEntityProp2 option").remove();
											for(var p2=0; p2<data[0].commTitles[0].prop2.props.length; p2++) {
												var $prop2Option ;
												if(p2 === 0) {
													$prop2Option = $("<option selected='selected'>" + data[0].commTitles[0].prop2.props[p2] +"</option>");
												} else {
													$prop2Option = $("<option>" + data[0].commTitles[0].prop2.props[p2] +"</option>");
												}
												$("#commEntityProp2").append($prop2Option);
											}
										} else {
											
										}
									},
									type:"post",
									url:"manage/selectMessage4addCommEntity.action"
								}); 
							}else {
									
							}
						},
						type:"post",
						url:"manage/findMain.action",
					});
					$("#addCommodityModel").hide();
					$("#addCommodityEntity").show();
					break;
				}
			});
			//添加商品模板选择类别联动菜单
			$("#commodityMainKinds").change(function() {
				var id = $("#commodityMainKinds option:selected").val();
				var data = $("#commodityMainKinds").data("data");
console.log(id);
				for(var i=0; i<data.length; i++) {
					if(data[i].id == id) {
						//清空子列表
						$("#commoditySubKinds option").remove();
						for(var j=0; j<data[i].subKinds.length; j++) {
//console.log(data[i].subKinds[j].kindName);
							var $option2 ;
							if(j === 0) {
								$option2 = $("<option selected='selected' value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
							} else {
								$option2 = $("<option value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
							}
							$("#commoditySubKinds").append($option2);
						}
					}
				}
			});
			
			//提交模板信息
			$("#submitCommodityMessage").click(function() {
				//标题
				var title = $("#commodityTitle").val().trim();
				//所属类别
				var subKind = $("#commoditySubKinds option:selected").val().trim();
				//属性1
				var propertyName1 = $("#property1").val().trim();
				var propertyContent1 = $("#property1Detail").val().trim();
				//属性2
				var propertyName2 = $("#property2").val().trim();
				var propertyContent2 = $("#property2Detail").val().trim();
				//品牌
				var brand = $("#brand").val().trim();
				//详情图片组
				var detailImage = $("#detailImageList input[class='detailImage']");
				if("" === title) {
					alert("标题不可为空");
					return;
				}
				if(isNaN(subKind) || subKind<0) {
					alert("出现一个异常，请刷新页面重试");
					return;
				}
				var counter1 = 0;
				var imageReg = /^.+\.(png)|(jpg)|(jpeg)|(gif)$/i;
				var imageName = "";
				if(propertyName1 === "" && propertyName2 === "") {
					alert("请至少填写一个属性项");
					return;
				}
				if(!(propertyName1 === "") && "" === propertyContent1) {
					alert("请填写属性一详情");
					return;
				}
				if(!(propertyName2 === "") && "" === propertyContent2) {
					alert("请填写属性二详情");
					return;
				}
				if(brand === "") {
					alert("请填写所属品牌");
					return;
				}
				counter1 = 0;
				imageName = "";
				for(var i=0; i<detailImage.length; i++) {
					imageName = detailImage.eq(i).val().trim();
					if(!(imageName === "")) {
						if(!(imageReg.test(imageName))) {
							alert("商品主图片出现非图片格式文件");
							return;
						} else {
							counter1 = counter1 + 1;
						}
					}
				}
				if(counter1 <= 0) {
					alert("商品详情图片至少选择一张");
					return;
				}
				//所有验证通过则提交表单
				//$("#commodityMessage").submit();
				 var data =  new FormData($("#commodityMessage").get(0));
				 $.ajax({
		            url: "manage/addCommodity.action",
		            type: "post",
		            data: data,
		            cache: false,
		            contentType: false,    //不可缺
		            processData: false,    //不可缺
		            error: function() {
		            	alert("连接服务器失败");
		            },
		            success:function(result){
		                if(result.status === 1) {
		                	$("#commodityMessage input").val("");
		                	$("#commodityMessage textarea").val("");
		                }
		                alert(result.info);
		            }
		        }); 
			});
			//添加商品实体选择类别联动菜单
			$("#commEntityMainKinds").change(function() {
				var id = $("#commEntityMainKinds option:selected").val();
				var data = $("#commEntityMainKinds").data("data");
console.log(id);
				for(var i=0; i<data.length; i++) {
					if(data[i].id == id) {
						//清空子列表
						$("#commEntitySubKinds2 option").remove();
						for(var j=0; j<data[i].subKinds.length; j++) {
//console.log(data[i].subKinds[j].kindName);
							var $option2 ;
							if(j === 0) {
								$option2 = $("<option selected='selected' value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
							} else {
								$option2 = $("<option value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
							}
							$("#commEntitySubKinds2").append($option2);
							
						}
					}
				}
			});
			//子分类列表改变重新加载品牌和商品标题以及属性
			$("#commEntitySubKinds2").change(function(){
				//子分类下拉选的值
				var subKindId = $("#commEntitySubKinds2 option:selected").val();
				$.ajax({
					data:{"subKindId":subKindId},
					dataType:"json",
					error:function(){
						alert("连接服务器失败");
					},
					success:function(result){
						if(result.status === 1) {
							var data = result.data;
							if(data.length <= 0) {
								alert("当前分类下未建立商品模板");
								//清空品牌下拉选
								$("#commEntityBrand option").remove();
								//清空商品标题下拉选
								$("#commEntityTitle option").remove();
								$("#popLable1").text("属性一");
								//清空属性一下拉选
								$("#commEntityProp1 option").remove();
								$("#popLable2").text("属性二");
								//清空属性一下拉选
								$("#commEntityProp2 option").remove();
								return;
							}
//console.log("data::" + data.length);
							//清空品牌下拉选
							$("#commEntityBrand option").remove();
							for(var i=0; i<data.length; i++) {
								var $option ;
								if(i === 0) {
									$option = $("<option selected='selected'>"+ data[i].brandName +"</option>");
								} else {
									$option = $("<option>"+ data[i].brandName +"</option>");
								}
								$("#commEntityBrand").append($option);
								$("#commEntityBrand").data("data", data);
							}
							//清空商品标题下拉选
							$("#commEntityTitle option").remove();
							for(var j=0; j<data[0].commTitles.length; j++) {
								var $titleOption ;
								if(j === 0) {
									$titleOption = $("<option value="+ data[0].commTitles[j].commId +" selected='selected'>" + data[0].commTitles[j].commTitle +"</option>");
								} else {
									$titleOption = $("<option value="+ data[0].commTitles[j].commId +">" + data[0].commTitles[j].commTitle +"</option>");
								}
								$("#commEntityTitle").append($titleOption);
							}
							/**
							*	初始化属性下拉选
							*/
							$("#popLable1").text(data[0].commTitles[0].prop1.propName);
							//清空属性一下拉选
							$("#commEntityProp1 option").remove();
							for(var p1=0; p1<data[0].commTitles[0].prop1.props.length; p1++) {
								var $prop1Option ;
								if(p1 === 0) {
									$prop1Option = $("<option selected='selected'>" + data[0].commTitles[0].prop1.props[p1] +"</option>");
								} else {
									$prop1Option = $("<option>" + data[0].commTitles[0].prop1.props[p1] +"</option>");
								}
								$("#commEntityProp1").append($prop1Option);
							}
							$("#popLable2").text(data[0].commTitles[0].prop2.propName);
							//清空属性二下拉选
							$("#commEntityProp2 option").remove();
							for(var p2=0; p2<data[0].commTitles[0].prop2.props.length; p2++) {
								var $prop2Option ;
								if(p2 === 0) {
									$prop2Option = $("<option selected='selected'>" + data[0].commTitles[0].prop2.props[p2] +"</option>");
								} else {
									$prop2Option = $("<option>" + data[0].commTitles[0].prop2.props[p2] +"</option>");
								}
								$("#commEntityProp2").append($prop2Option);
							}
						} else {
							
						}
					},
					type:"post",
					url:"manage/selectMessage4addCommEntity.action"
				});
			});
			/**
			*	添加商品实体的品牌、标题、属性三级联动下拉选
			*/
			//三级联动下拉选之品牌改变
			$("#commEntityBrand").change(function(){
				var data = $("#commEntityBrand").data("data");
				var brandName = $("#commEntityBrand option:selected").text().trim();
				for(var i=0; i<data.length; i++) {
					if(data[i].brandName === brandName) {
						//清空商品标题下拉选
						$("#commEntityTitle option").remove();
						for(var j=0; j<data[i].commTitles.length; j++) {
							var $titleOption ;
							if(j === 0) {
								$titleOption = $("<option value="+ data[i].commTitles[j].commId +" selected='selected'>" + data[i].commTitles[j].commTitle +"</option>");
							} else {
								$titleOption = $("<option value="+ data[i].commTitles[j].commId +">" + data[i].commTitles[j].commTitle +"</option>");
							}
							$("#commEntityTitle").append($titleOption);
						}
						/**
						*	初始化属性下拉选
						*/
						$("#popLable1").text(data[i].commTitles[0].prop1.propName);
						//清空属性一下拉选
						$("#commEntityProp1 option").remove();
						for(var p1=0; p1<data[i].commTitles[0].prop1.props.length; p1++) {
							var $prop1Option ;
							if(p1 === 0) {
								$prop1Option = $("<option selected='selected'>" + data[i].commTitles[0].prop1.props[p1] +"</option>");
							} else {
								$prop1Option = $("<option>" + data[i].commTitles[0].prop1.props[p1] +"</option>");
							}
							$("#commEntityProp1").append($prop1Option);
						}
						$("#popLable2").text(data[i].commTitles[0].prop2.propName);
						//清空属性一下拉选
						$("#commEntityProp2 option").remove();
						for(var p2=0; p2<data[i].commTitles[0].prop2.props.length; p2++) {
							var $prop2Option ;
							if(p2 === 0) {
								$prop2Option = $("<option selected='selected'>" + data[i].commTitles[0].prop2.props[p2] +"</option>");
							} else {
								$prop2Option = $("<option>" + data[i].commTitles[0].prop2.props[p2] +"</option>");
							}
							$("#commEntityProp2").append($prop2Option);
						}
					}
				}
			});
			//三级联动下拉选之商品标题改变
			$("#commEntityTitle").change(function(){
				var data = $("#commEntityBrand").data("data");
				var brandName = $("#commEntityBrand option:selected").text().trim();
				var titleName = $("#commEntityTitle option:selected").text().trim();
				for(var i=0; i<data.length; i++) {
					if(data[i].brandName === brandName) {
						for(var j=0; j<data[i].commTitles.length; j++) {
							if(data[i].commTitles[j].commTitle === titleName) {
								/**
								*	初始化属性下拉选
								*/
								$("#popLable1").text(data[i].commTitles[j].prop1.propName);
								//清空属性一下拉选
								$("#commEntityProp1 option").remove();
								for(var p1=0; p1<data[i].commTitles[j].prop1.props.length; p1++) {
									var $prop1Option ;
									if(p1 === 0) {
										$prop1Option = $("<option selected='selected'>" + data[i].commTitles[j].prop1.props[p1] +"</option>");
									} else {
										$prop1Option = $("<option>" + data[i].commTitles[j].prop1.props[p1] +"</option>");
									}
									$("#commEntityProp1").append($prop1Option);
								}
								$("#popLable2").text(data[i].commTitles[j].prop2.propName);
								//清空属性一下拉选
								$("#commEntityProp2 option").remove();
								for(var p2=0; p2<data[i].commTitles[0].prop2.props.length; p2++) {
									var $prop2Option ;
									if(p2 === 0) {
										$prop2Option = $("<option selected='selected'>" + data[i].commTitles[j].prop2.props[p2] +"</option>");
									} else {
										$prop2Option = $("<option>" + data[i].commTitles[j].prop2.props[p2] +"</option>");
									}
									$("#commEntityProp2").append($prop2Option);
								}
							}
						}
						
					}
				}
			});
			//提交实体信息
			$("#submitCommEntityMessage").click(function(){
				//商品id
				var commId = $("#commEntityTitle option:selected").val();
				//商品属性
				var prop1 = $("#commEntityProp1 option:selected").text();
				var prop2 = $("#commEntityProp2 option:selected").text();
				//主图片组
				var mainImages = $("#mainImageList input[class='mainImage']");
				//库存
				var inventory = $("#commEntityInventory").val().trim();
				//售价
				var price = $("#myPrice").val().trim();
				//市场价
				var marketPrice = $("#marketPrice").val().trim();
				//参数
				var paramDetail = $("#paramDetail").val().trim();
				/**
				*	数据校验
				*/
				//主图片校验
				var counter1 = 0;
				var imageReg = /^.+\.(png)|(jpg)|(jpeg)|(gif)$/i;
				var imageName = "";
				var mainImageNames = new Array(mainImages.length);
				for(var i=0; i<mainImages.length; i++) {
					imageName = mainImages.eq(i).val().trim();
					if(!(imageName === "")) {
						if(!(imageReg.test(imageName))) {
							alert("商品主图片出现非图片格式文件");
							return;
						} else {
							counter1 = counter1 + 1;
							mainImageNames[i] = imageName;
						}
					}
				}
				if(!checkInteger(inventory)) {
					alert("库存有效值为 1-999999");
					return;
				}
				if(!checkBigDicemal(price)) {
					alert("售价有效值为 0.00-999999999.00");
					return;
				}
				if(counter1 <= 0) {
					alert("商品主图片至少选择一张");
					return;
				}
				if(paramDetail === "") {
					alert("请填写参数详情");
					return;
				}
				var data =  new FormData($("#commEntityForm").get(0));
				data.append("propty1",prop1);
				data.append("propty2",prop2);
				$.ajax({
					url: "manage/addCommEntity.action",
		            type: "post",
		            data: data,
		            cache: false,
		            contentType: false,    //不可缺
		            processData: false,    //不可缺
		            error: function() {
		            	alert("连接服务器失败");
		            },
		            success:function(result){
		                if(result.status === 1) {
		                	/* $("#commodityMessage input").val("");
		                	$("#commodityMessage textarea").val(""); */
		                	$("#mainImageList input[class='mainImage']").val("");
		                	$("#commEntityInventory").val("");
		                	$("#myPrice").val("");
		                	$("#marketPrice").val("");
							$("#paramDetail").val("");
		                }
		                alert(result.info);
		            }
				});
			});
		});
	</script>
</body>
</html>
