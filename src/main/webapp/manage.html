<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->

<title>管理员页面</title>

<!-- Bootstrap -->
<link href="resources/plugins/bootstrap/css/bootstrap.min.css"
	rel="stylesheet">
<link href="resources/my-css/manage.css" rel="stylesheet">
<link href="resources/my-css/user-base.css" rel="stylesheet">
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-1">
				<h4>内部管理</h4>
			</div>
		</div>
		<hr/>
		<div class="row">
			<div class="col-md-2">
				<ul class="list-group" id="managerList">
				  <li class="list-group-item list-1">分类管理</li>
				  <li class="list-group-item list-1">添加商品</li>
				  <li class="list-group-item list-1">Morbi leo risus</li>
				  <li class="list-group-item list-1">Porta ac consectetur ac</li>
				  <li class="list-group-item list-1">Vestibulum at eros</li>
				</ul>
			</div>
			<div class="col-md-10 content" >
				<!-- 分类管理 -->
				<div class="kinds-content" id="kinds_content" style="display: none;">
					<ul class="nav nav-tabs" id="kinds_operate">
					  <li role="presentation" class="list-2"><a>添加主分类</a></li>
					  <li role="presentation" class="list-2"><a>添加子分类</a></li>
					  <li role="presentation" class="list-2"><a>删除主分类</a></li>
					  <li role="presentation" class="list-2"><a>删除子分类</a></li>
					</ul>
					<!-- 添加主分类 -->
					<div class="operate-content col-md-12" id="add_main">
						<div class="form-group">
						    <label for="main-kinds">主分类输入</label>
						    <input type="text" class="form-control" id="main-kinds">
						</div>
						<div class="form-group">
						    <label for="subsidiary_kinds1">从分类输入</label>
						    <textarea class="form-control" id="subsidiary_kinds1" rows="3"></textarea>
						</div>
						<button type="button" class="btn btn-danger col-md-2" id="sub_main">提交</button>
					</div>
					<!-- 添加从分类 -->
					<div class="operate-content col-md-12" id="add_subsidiary">
						<div class="form-group">
						    <label for="main_kinds_l1">选择主分类</label>
						    <select class="form-control" id="main_kinds_l1">
							  <option>1</option>
							  <option>2</option>
							  <option>3</option>
							  <option>4</option>
							  <option>5</option>
							</select>
						</div>
						<div class="form-group">
						    <label for="subsidiary_kinds2">从分类输入</label>
						    <textarea class="form-control" id="subsidiary_kinds2" rows="3"></textarea>
						</div>
						<button type="button" class="btn btn-danger col-md-2" id="submitSubKind">提交</button>
					</div><!--  -->
					<!-- 删除主分类 -->
					<div class="operate-content col-md-12" id="delete_main">
						<div class="form-group">
						    <label for="main_kinds_l2">删除主分类</label>
						    <select class="form-control" id="main_kinds_l2">
							  
							</select>
						</div>
						<button type="button" class="btn btn-danger col-md-2" id="deleteMain">删除</button>
					</div><!--  -->
					<!-- 删除从分类 -->
					<div class="operate-content col-md-12" id="delete_subsidiary">
						<div class="form-group">
						    <label for="main_kinds_l3">选择主分类</label>
						    <select class="form-control" id="main_kinds_l3">
							  
							</select>
						</div>
						<div class="form-group">
						    <label for="subsidiary_kinds3">删除从分类</label>
						    <select class="form-control" id="subsidiary_kinds3">
							  
							</select>
						</div>
						<button type="button" class="btn btn-danger col-md-2">删除</button>
					</div><!--  -->
				</div><!--分类管理结束 -->
				<!-- 添加商品开始 -->
				<div class="kinds-content" id="commodityContent">
					<form action="manage/addCommodity.action"  id="commodityMessage" method="post" enctype="multipart/form-data">
						<div class="form-group">
						    <label for="commodityTitle">商品标题</label>
						    <input type="text" class="form-control" id="commodityTitle" name="titleName">
						</div>
						<hr>
						<div class="form-group">
						    <label for="commodityMainKinds">所属主类别</label>
						    <select class="form-control" id="commodityMainKinds">
							  <option>A</option>
							  <option>B</option>
							  <option selected="selected">C</option>
							</select>
						</div>
						<div class="form-group">
						    <label for="commoditySubKinds">所属子类别</label>
						    <select class="form-control" id="commoditySubKinds" name="belongKindId">
							  <option>1</option>
							  <option>2</option>
							  <option>3</option>
							</select>
						</div>
						<hr>
						 <div class="form-group" id="mainImageList">
						    <label for="mainImage1">商品主图片</label>
						    <input type="file" name="file" class="mainImage">
						    <label class="sr-only" for="mainImage2">File input</label>
						    <input type="file" name="file" class="mainImage">
						    <label class="sr-only" for="mainImage3">File input</label>
						    <input type="file" name="file" class="mainImage">
						    <label class="sr-only" for="mainImage4">File input</label>
						    <input type="file" name="file" class="mainImage">
						    <p class="help-block">请上传380x460像素比例图片</p>
						  </div>
						  <hr>
						  <div class="form-group">
						    <label for="commodityInventory">库存</label>
						    <input type="text" class="form-control" id="commodityInventory" name="inventory">
						</div>
						<div class="form-group">
						    <label for="myPrice">销售价</label>
						    <input type="text" class="form-control" id="myPrice" name="myPrice">
						</div>
						<div class="form-group">
						    <label for="marketPrice">市场价</label>
						    <input type="text" class="form-control" id="marketPrice" name="marketPrice">
						</div>
						<hr>
						<div class="form-group">
						    <label for="property1">属性一</label>
						    <input type="text" class="form-control" id="property1" name="property1">
						</div>
						<div class="form-group">
						    <label for="property1Detail">属性一详情</label>
						    <textarea class="form-control" id="property1Detail" rows="3" name="property1Content"></textarea>
						</div>
						<hr>
						<div class="form-group">
						    <label for="property2">属性二</label>
						    <input type="text" class="form-control" id="property2" name="property2">
						</div>
						<div class="form-group">
						    <label for="property2Detail">属性二详情</label>
						    <textarea class="form-control" id="property2Detail" rows="3" name="property2Content"></textarea>
						</div>
						<hr>
						<div class="form-group">
						    <label for="brand">所属品牌</label>
						    <input type="text" class="form-control" id="brand" name="brand">
						</div>
						<div class="form-group">
						    <label for="paramDetail">参数详情</label>
						    <textarea class="form-control" id="paramDetail" rows="3" name="paramss"></textarea>
						</div>
						<hr>
						<div class="form-group" id="detailImageList">
						    <label for="detailImage1">商品详情图片</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage2">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage3">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage4">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage5">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage6">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage7">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage8">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage9">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <label class="sr-only" for="detailImage10">File input</label>
						    <input type="file" name="file" class="detailImage">
						    <p class="help-block">请上传1200x560像素比例图片最佳</p>
						  </div>
						 </form>
					  <button type="button" class="btn btn-danger col-md-3" id="submitCommodityMessage">提交</button>
				</div><!-- 添加商品结束 -->
			</div>
		</div>
		<hr/>
		<div class="page-copyright text-center">
			Copyright &copy; 2017 <strong>爱购商城i-go.shop</strong> 版权所有
		</div>
	</div>
	<script src="resources/plugins/jquery-2.2.4.min.js"></script>
	<script src="resources/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="resources/scripts/my-utils.js"></script>
	<script type="text/javascript" src="resources/scripts/manage/manage.js"></script>
	<script type="text/javascript">
		$(function() {
			//主操作列表点击事件
			$("#managerList").click(function(event) {
				var $target = $(event.target);
				switch($target.text().trim())
				{
				case "分类管理":
					disManageList(1);
				  	break;
				case "添加商品":
					//发送请求加载分类
					$.ajax({
						data:"",
						dataType:"json",
						error:function() {
							
						},
						success:function(result) {
							if(result.status === 1) {
								var data = result.data;
								//清空列表
								$("#commodityMainKinds option").remove();
								for(var i=0; i<data.length; i++) {
									var $option;
									if(i===0) {
										$option = $("<option selected='selected' value="+ data[i].id +">"+data[i].kindName+"</option>");
										//清空列表
										$("#commoditySubKinds option").remove();
										for(var j=0; j<data[i].subKinds.length; j++) {
											var $option2 ;
											if(j === 0) {
												$option2 = $("<option selected='selected' value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
											} else {
												$option2 = $("<option value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
											}
											$("#commoditySubKinds").append($option2);
										}
									} else {
										$option = $("<option value="+ data[i].id +">"+data[i].kindName+"</option>");
									}
									$("#commodityMainKinds").data("data", data);
									$("#commodityMainKinds").append($option);
								} 
							}else {
									
							}
						},
						type:"post",
						url:"manage/findMain.action",
					});
					disManageList(2);
					break;
				}
			});
			//类操作事件
			$("#kinds_operate").click(function(event){
				var $target = $(event.target);
				$("#kinds_operate").children("li").removeClass("active");
				$target.parent().addClass("active");
				switch($target.text().trim())
				{
				case "添加主分类":
				  	operKindsDis(1);
				  	break;
				case "添加子分类":
					//发送请求加载主分类
					$.ajax({
						data:"",
						dataType:"json",
						error:function() {
							alert("连接服务器失败");
						},
						success:function(result) {
							if(result.status === 1) {
								var data = result.data;
console.log(data);
								//清空原来列表
								$("#main_kinds_l1").html("");
								for(var i=0; i<data.length; i++) {
									var $option = $("<option>" +data[i].kindName + "</option>");
									$option.data("id", data[i].id);
									$("#main_kinds_l1").append($option);
									//提交可点
									$("#submitSubKind").removeAttr("disabled");
								}
							} else {
								alert(result.info);
								//提交按钮不可点
								$("#submitSubKind").attr("disabled", "disabled");
							}
						},
						type:"post",
						url:"manage/findMain.action"
					});
				 	operKindsDis(2);
				  	break;
				case "删除主分类":
					//发送请求加载主分类
					$.ajax({
						data:"",
						dataType:"json",
						error:function() {
							alert("连接服务器失败");
						},
						success:function(result) {
							if(result.status === 1) {
								var data = result.data;
								//清空原来列表
								$("#main_kinds_l2").html("");
								for(var i=0; i<data.length; i++) {
									var $option = $("<option>" +data[i].kindName + "</option>");
									$option.data("id", data[i].id);
									$("#main_kinds_l2").append($option);
									//删除可点
									$("#deleteMain").removeAttr("disabled");
								}
							} else {
								alert(result.info);
								//删除按钮不可点
								$("#deleteMain").attr("disabled", "disabled");
							}
						},
						type:"post",
						url:"manage/findMain.action"
					});
				  	operKindsDis(3);
				  	break;
				case "删除子分类":
				  	operKindsDis(4);
				  	break;
				}
			});
			//提交新建主类事件
			$("#sub_main").click(function(){
				var mainText = $("#main-kinds").val().trim();
				var subText = $("#subsidiary_kinds1").val().trim();
				if(""===mainText || ""===subText) {
					alert("主类和子类均不可为空");
					return;
				}
				$.ajax({
					data:{mainName:mainText,subName:subText},
					dataType:"json",
					error:function() {
						alert("连接服务器失败");
					},
					success:function(result) {
						if(result.status === 1) {
							$("#main-kinds").val("");
							$("#subsidiary_kinds1").val("");
							alert("添加成功");
						} else {
							alert(result.info);
						}
					},
					type:"post",
					url:"manage/addMainKind.action"
				});
			});
			//提交辅类提交事件
			$("#submitSubKind").click(function() {
				var subText = $("#subsidiary_kinds2").val().trim();
				var mainId = $("#main_kinds_l1 option:selected").data("id");
				if(subText === "" || undefined=== mainId) {
					alert("输入有误或操作非法");
					return;
				}
				$.ajax({
					data:{mainId:mainId,subName:subText},
					dataType:"json",
					error:function() {
						alert("连接服务器失败");
					},
					success:function(result) {
						if(result.status === 1) {
							$("#subsidiary_kinds2").val("");
							alert("添加成功");
						} else {
							alert(result.info);
						}
					},
					type:"post",
					url:"manage/addSubKind.action"
				});
			});
			//删除主类事件
			$("#deleteMain").click(function() {
				var mainId = $("#main_kinds_l2 option:selected").data("id");
				if(undefined=== mainId) {
				alert("不可执行该操作");
					return;
				}
				$.ajax({
					data:{mainId:mainId},
					dataType:"json",
					error:function() {
						alert("连接服务器失败");
					},
					success:function(result) {
						if(result.status === 1) {
							alert("删除成功");
						} else {
							alert(result.info);
						}
					},
					type:"post",
					url:"manage/deleteMain.action"
				});
			});
			/**
			 * 添加商品相关js
			 **/
			//选择类别联动菜单
			$("#commodityMainKinds").change(function() {
				var id = $("#commodityMainKinds option:selected").val();
				var data = $("#commodityMainKinds").data("data");
console.log(id);
				for(var i=0; i<data.length; i++) {
					if(data[i].id == id) {
						//清空子列表
						$("#commoditySubKinds option").remove();
						for(var j=0; j<data[i].subKinds.length; j++) {
//console.log(data[i].subKinds[j].kindName);
							var $option2 ;
							if(j === 0) {
								$option2 = $("<option selected='selected' value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
							} else {
								$option2 = $("<option value="+ data[i].subKinds[j].id +">"+data[i].subKinds[j].kindName+"</option>");
							}
							$("#commoditySubKinds").append($option2);
						}
					}
				}
			});
			//提交信息
			$("#submitCommodityMessage").click(function() {
				//标题
				var title = $("#commodityTitle").val().trim();
				//所属类别
				var subKind = $("#commoditySubKinds option:selected").val().trim();
				//主图片组
				var mainImages = $("#mainImageList input[class='mainImage']");
				//库存
				var inventory = $("#commodityInventory").val().trim();
				//售价
				var price = $("#myPrice").val().trim();
				//市场价
				var marketPrice = $("#marketPrice").val().trim();
				//属性1
				var propertyName1 = $("#property1").val().trim();
				var propertyContent1 = $("#property1Detail").val().trim();
				//属性2
				var propertyName2 = $("#property2").val().trim();
				var propertyContent2 = $("#property2Detail").val().trim();
				//品牌
				var brand = $("#brand").val().trim();
				//参数
				var paramDetail = $("#paramDetail").val().trim();
				//详情图片组
				var detailImage = $("#detailImageList input[class='detailImage']");
				if("" === title) {
					alert("标题不可为空");
					return;
				}
				if(isNaN(subKind) || subKind<0) {
					alert("出现一个异常，请刷新页面重试");
					return;
				}
				var counter1 = 0;
				var imageReg = /^.+\.(png)|(jpg)|(jpeg)|(gif)$/i;
				var imageName = "";
				var mainImageNames = new Array(mainImages.length);
				for(var i=0; i<mainImages.length; i++) {
					imageName = mainImages.eq(i).val().trim();
					if(!(imageName === "")) {
						if(!(imageReg.test(imageName))) {
							alert("商品主图片出现非图片格式文件");
							return;
						} else {
							counter1 = counter1 + 1;
							mainImageNames[i] = imageName;
						}
					}
				}
				if(!checkInteger(inventory)) {
					alert("库存有效值为 1-999999");
					return;
				}
				if(!checkBigDicemal(price)) {
					alert("售价有效值为 0.00-999999999.00");
					return;
				}
				if(counter1 <= 0) {
					alert("商品主图片至少选择一张");
					return;
				}
				if(propertyName1 === "" && propertyName2 === "") {
					alert("请至少填写一个属性项");
					return;
				}
				if(!(propertyName1 === "") && "" === propertyContent1) {
					alert("请填写属性一详情");
					return;
				}
				if(!(propertyName2 === "") && "" === propertyContent2) {
					alert("请填写属性二详情");
					return;
				}
				if(brand === "") {
					alert("请填写所属品牌");
					return;
				}
				if(paramDetail === "") {
					alert("请填写参数详情");
					return;
				}
				counter1 = 0;
				imageName = "";
				for(var i=0; i<detailImage.length; i++) {
					imageName = detailImage.eq(i).val().trim();
					if(!(imageName === "")) {
						if(!(imageReg.test(imageName))) {
							alert("商品主图片出现非图片格式文件");
							return;
						} else {
							counter1 = counter1 + 1;
						}
					}
				}
				if(counter1 <= 0) {
					alert("商品详情图片至少选择一张");
					return;
				}
				//所有验证通过则提交表单
				//$("#commodityMessage").submit();
				 var data =  new FormData($("#commodityMessage").get(0));
				 data.append("mainImages",mainImageNames);
				 $.ajax({
		            url: "manage/addCommodity.action",
		            type: "post",
		            data: data,
		            cache: false,
		            contentType: false,    //不可缺
		            processData: false,    //不可缺
		            error: function() {
		            	alert("连接服务器失败");
		            },
		            success:function(result){
		                if(result.status === 1) {
		                	$("#commodityMessage input").val("");
		                	$("#commodityMessage textarea").val("");
		                }
		                alert(result.info);
		            }
		        }); 
			});
		});
	</script>
</body>
</html>
