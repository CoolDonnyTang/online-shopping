<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
		
		<title>请登录</title>
		
		<!-- Bootstrap -->
		<link href="resources/plugins/bootstrap/css/bootstrap.min.css"
			rel="stylesheet">
		<link href="resources/my-css/login.css" rel="stylesheet">
		<link href="resources/my-css/user-base.css" rel="stylesheet">
	</head>
	<body>
		<div class="container-fluid">
			<div class="login-logo">
				<a><img src="resources/images/logo.png" class="login-logo-image"></a>
			</div>
			<div class="loin-page-body" id="user-info">
				<div class="login-container col-sm-3 col-md-offset-8 col-xs-10 col-xs-offset-1">
					<div class="login-kind">
						<h5>
							<strong>账户登录</strong>
						</h5>
					</div>
					<div class="input-group user-message">
						<span class="input-group-addon" id="basic-addon1"><span
							class="glyphicon glyphicon-user"></span></span> <input type="text"
							class="form-control" placeholder="用户名"
							aria-describedby="basic-addon1" id="userName">
					</div>
					<div class="input-group user-message">
						<span class="input-group-addon" id="basic-addon2"><span
							class="glyphicon glyphicon-lock"></span></span> <input type="password"
							class="form-control" placeholder="密码"
							aria-describedby="basic-addon2" id="pwd">
					</div>
					<div class="form-group">
					    <label for="inputCheckCode" class="sr-only">验证码：</label>
					    <input type="text" class="form-control" id="inputCheckCode" placeholder="验证码" style="width: 40%;display: inline-block;">
					    <img src="user/codeImage.action" class="code-image" id="loginCodeImage" title="点击更换">
					 </div>
					<button type="button" class="btn btn-danger btn-login" id="login">登录</button>
					<div class="error-container">
						<div class="login-error" id="loginMessage">
							<span class="error-icon"></span><span id="errorMessage">weA的</span>
						</div>
					</div>
					<div class="find-pwd-or-register">
						<ul class="operation-list">
							<li><a href="change-pwd.html">忘记密码</a></li>
							<li><a href="register.html">免费注册</a></li>
						</ul>
					</div>
				</div>
			</div>
			<hr />
			<div class="page-footer-body text-center">
				<ul class="footer-list">
					<li>关于我们</li>
					<li>联系我们</li>
					<li>亲情加盟</li>
					<li>商城社区</li>
					<li>我在中国</li>
					<li>友情链接</li>
				</ul>
			</div>
			<div class="page-copyright text-center">
				Copyright &copy; 2017 <strong>爱购商城i-go.shop</strong> 版权所有
			</div>
		</div>
		<script src="resources/plugins/jquery-2.2.4.min.js"></script>
		<script src="resources/plugins/bootstrap/js/bootstrap.min.js"></script>
		<script src="resources/scripts/my-utils.js"></script>
		<script type="text/javascript">
			$(function(){
				$("#loginCodeImage").click(function(){
					$("#loginCodeImage").attr("src", "user/codeImage.action?" + Math.random());
				});
				
				//鼠标移如输入框清除错误样式
				$("#user-info").focusin(function() {
					$("#loginMessage").hide();
				});
				//点击登录按钮 /login.action
				$("#login").click(function(){
					var userName = $("#userName").val().trim();
					var pwd = $("#pwd").val().trim();
					var checkCode = $("#inputCheckCode").val().trim().toLowerCase();
					if(!checkCheckCode(checkCode)) {
						$("#loginMessage").show();
						$("#errorMessage").text("验证码错误");
						return;
					}
					if(((!checkNickname(userName))&&(!checkEmail(userName))) || (!checkPassword(pwd))) {
						$("#loginMessage").show();
						$("#errorMessage").text("用户名或密码错误");
						return;
					}
					//如果使用邮箱登录则转换为小写
					if(checkEmail(userName)) {
						userName = userName.toLowerCase();
					}
					//发送请求
					$.ajax({
						data:{"userName":userName,"password":pwd,"checkCode":checkCode},
						dataType:"json",
						error:function() {
							$("#loginMessage").show();
							$("#errorMessage").text("连接服务器失败");
						},
						success:function(result) {
							if(result.status === 1) {
								alert("登录成功");
								return;
							}
							//验证码错误切换验证码
							$("#loginCodeImage").get(0).click();
							$("#loginMessage").show();
							$("#errorMessage").text(result.info);
						},
						type:"post",
						url:"user/login.action"
					});
				});
			});
		</script>
	</body>
</html>
