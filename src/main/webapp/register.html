<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->

<title>免费注册</title>

<!-- Bootstrap -->
<link href="resources/plugins/bootstrap/css/bootstrap.min.css"
	rel="stylesheet">
<link href="resources/my-css/register.css" rel="stylesheet">
<link href="resources/my-css/user-base.css" rel="stylesheet">
</head>
<body>
	<div class="container-fluid">
		<div class="login-logo">
			<a><img src="resources/images/logo.png" class="login-logo-image"></a>
		</div>
		<div class="register-page-header">
			<div class="col-md-offset-1">
				<img src="resources/images/register.png" class="register-image">
				<strong>用户注册</strong>
			</div>
		</div>
		<div class="register-body">
			<div class="col-sm-8 col-md-offset-2 col-xs-12 ">
				<div class="progress">
					<div class="progress-bar" role="progressbar" style="width: 33%;" id="progress">
						邮箱验证 1/3
					</div>
				</div>
				<div class="col-sm-10 col-md-offset-2 col-xs-12 verify-email" id="verify">
					<div class="form-group">
					    <label for="inputEmail">电子邮箱：</label><br>
					    <input type="text" class="form-control" id="inputEmail" placeholder="邮箱" style="width: 40%;display: inline-block;">
					    <button type="button" class="btn btn-info btn-xs" id="checkMail">发送验证码</button>
					    <span id="checkMailMessage"></span>
					 </div>
					 <div class="form-group">
					    <label for="inputCheckCode">验证码：</label><br>
					    <input type="text" class="form-control" id="inputCheckCode" placeholder="验证码" style="width: 20%;display: inline-block;">
					    <span id="checkCodeMessage"></span>
					 </div>
					 <button type="button" class="btn btn-danger col-md-6" style="margin:30px 0" disabled="disabled" id="checkMailAndCode">下一步</button>
				</div>
				<div class="col-sm-10 col-md-offset-2 col-xs-12 input-user-info" id="input-info">
					<table>
						<tr>
							<td>
								<div class="form-group">
								    <label for="inputNickname">会员昵称：</label>
								    <input type="text" class="form-control" id="inputNickname" placeholder="昵称">
								    <p class="info-warning" id="nicknameError"></p>
								 </div>
							</td>
							<td>4-10中文、英文、数字、下划线组合</td>
						</tr>
						<tr>
							<td>
								<div class="form-group">
								    <label for="inputIdNumber">二代身份证号码：</label>
								    <input type="text" class="form-control" id="inputIdNumber" placeholder="证件号">
								    <p class="info-warning" id="idNumberError"></p>
								 </div>
							</td>
							<td>合法的二代身份证号码</td>
						</tr>
						<tr>
							<td>
								<div class="form-group">
								    <label for="inputPwd">用户密码：</label>
								    <input type="password" class="form-control" id="inputPwd" placeholder="密码">
								    <p class="info-warning" id="pwd1Error"></p>
								 </div>
							</td>
							<td>必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-16之间</td>
						</tr>
						<tr>
							<td>
								<div class="form-group">
								    <label for="inputPwd2">确认密码：</label>
								    <input type="password" class="form-control" id="inputPwd2" placeholder="确认密码">
								    <p class="info-warning" id="pwd2Error"></p>
								 </div>
							</td>
							<td></td>
						</tr>
					</table>
					<div class="register-warning">
						<div class="alert alert-danger" role="alert" style="display: none" id="warning-message"></div>
					</div>
					<div class="col-sm-6 col-xs-6" style="padding:20px 0">
						<button type="button" class="btn btn-danger btn-register-submit" id="submit-info">提交</button>
					</div>
				</div>
				<div class="col-sm-4 col-md-offset-4 col-xs-12 register-right" id="register-result">
					<div class="register-right-display">
						<img src="resources/images/register-right.png">&nbsp;&nbsp;注册成功
					</div>
					<a class="btn btn-danger" href="login.html" role="button" style="width:100%">立即登录</a>
				</div>
			</div>
		</div>
		<hr />
		<div class="page-footer-body text-center">
			<ul class="footer-list">
				<li>关于我们</li>
				<li>联系我们</li>
				<li>亲情加盟</li>
				<li>商城社区</li>
				<li>我在中国</li>
				<li>友情链接</li>
			</ul>
		</div>
		<div class="page-copyright text-center">
			Copyright &copy; 2017 <strong>爱购商城i-go.shop</strong> 版权所有
		</div>
	</div>
	<script src="resources/plugins/jquery-2.2.4.min.js"></script>
	<script src="resources/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="resources/scripts/my-utils.js"></script>
	<script type="text/javascript" src="resources/scripts/register.js"></script>
	<script type="text/javascript">
		$(function(){
			//发送验证码
			$("#checkMail").click(function(){
				//检查按钮是否可点击
				if($("#checkMail").attr("disabled")==="disabled") {
					return;
				}
				//清除验证码提示信息
				$("#checkCodeMessage").text("");
				var email = $("#inputEmail").val().trim().toLowerCase();
				$("#checkMailMessage").text("");
				//使”下一步“按钮不可点击
				$("#checkMailAndCode").attr("disabled", "disabled");
				if(!checkEmail(email)) {
					$("#checkMailMessage").text("请输入正确的邮箱格式");
				} else {
					$("#checkMailMessage").text("发送中...");
					$.ajax({
						data:{"email":email},
						dataType:"json",
						type:"post",
						url:"user/checkMail.action",
						error:function() {
							$("#checkMailMessage").text("连接服务器失败");
							//使发送验证码按钮可点击
							$("#checkMail").removeAttr("disabled");
						},
						success:function(result) {
							if(result.status === 1) {
								//重新发送验证码时间
								var resendTime = 10;
								//下一步按钮可点击
								$("#checkMailAndCode").removeAttr("disabled");
								//验证码按钮不可点击
								$("#checkMail").attr("disabled", "disabled");
								$("#checkMailMessage").text(resendTime + "秒后可再次发送");
								var timerId = window.setInterval(function() {
									if(resendTime < 1) {
										$("#checkMailMessage").text("");
										clearInterval(timerId);
										//使发送验证码按钮可点击
										$("#checkMail").removeAttr("disabled");
										return;
									}
									$("#checkMailMessage").text(--resendTime + "秒后可再次发送");
								}, 1000);
							} else {
								$("#checkMailMessage").text(result.info);
								//使发送验证码按钮可点击
								$("#checkMail").removeAttr("disabled");
							}
						}
					});
				}
			});
			
			
			//鼠标切入验证码框时清除提示信息
			$("#inputCheckCode").focusin(function() {
				$("#checkCodeMessage").text("");
			});
			//点击下一步时
			$("#checkMailAndCode").click(function(){
				var email = $("#inputEmail").val().trim().toLowerCase();
				//验证码值
				var checkCode = $("#inputCheckCode").val().trim().toLowerCase();
				//检查按钮是否可点击且验证码是否为5位
				if($("#checkMailAndCode").attr("disabled")==="disabled") {
					return;
				}
				//清除提示信息
				$("#checkCodeMessage").text("");
				if(checkCode.length != 5) {
					$("#checkCodeMessage").text("请确认验证码是否正确");
					return;
				}
				$.ajax({
						data:{"email":email,"checkCode":checkCode},
						dataType:"json",
						type:"post",
						url:"user/checkEmailCode.action",
						error:function() {
							$("#checkCodeMessage").text("验证失败 请稍后再试");
						},
						success:function(result) {
							if(result.status === 1) {
								$("#input-info").show();
								$("#verify").hide();
								$("#progress").width("66%").text("填写基本信息 2/3");
							} else {
								//使”下一步“按钮不可点击
								$("#checkMailAndCode").attr("disabled", "disabled");
								$("#checkCodeMessage").text(result.info);
							}
						}
					});
			});
			
			//鼠标切入输入框清除提示信息及错误样式
			$("#input-info input").focusin(function(event) {
				//获取事件源
				var $target = $(event.target);
				if($target.attr("id") === "inputNickname") {
					$("#nicknameError").text("");
					$("#nicknameError").parent().removeClass("has-error");
					return;
				}
				if($target.attr("id") === "inputIdNumber") {
					$("#idNumberError").text("");
					$("#idNumberError").parent().removeClass("has-error");
					return;
				}
				if($target.attr("id") === "inputPwd") {
					$("#pwd1Error").text("");
					$("#pwd1Error").parent().removeClass("has-error");
					return;
				}
				if($target.attr("id") === "inputPwd2") {
					$("#pwd2Error").text("");
					$("#pwd2Error").parent().removeClass("has-error");
					return;
				}
			});
			//点击提交按钮提交
			$("#submit-info").click(function(){
				var nickname = $("#inputNickname").val();
				var idNumber = $("#inputIdNumber").val().trim().toLowerCase();
				var pwd = $("#inputPwd").val();
				var pwd2 = $("#inputPwd2").val(); 
				//标识验证是否通过
				var flag = true;
				//隐藏警告框
				$("#warning-message").hide();
				if(!checkNickname(nickname)) {
					$("#nicknameError").text("* 用户名输入不合法");
					$("#nicknameError").parent().addClass("has-error");
					flag = false;
				}
				if(!checkIdNumber(idNumber)) {
					$("#idNumberError").text("* 身份证号码输入不合法");
					$("#idNumberError").parent().addClass("has-error");
					flag = false;
				}
				if(!checkPassword(pwd)) {
					$("#pwd1Error").text("* 密码组合不合法");
					$("#pwd1Error").parent().addClass("has-error");
					flag = false;
				}
				if(pwd !== pwd2) {
					$("#pwd2Error").text("* 两次密码输入不相同");
					$("#pwd2Error").parent().addClass("has-error");
					flag = false;
				}
				if(flag === false) {
					return;
				}
				//验证通过发送ajax
				$.ajax({
					data:{"nickname":nickname,"password":pwd,"idNumber":idNumber},
					dataType:"json",
					error:function() {
						$("#warning-message").show();
						$("#warning-message").text("连接服务器失败，请稍后再试");
					},
					success:function(result) {
						if(result.status === 1) {
							$("#input-info").hide();
							$("#register-result").show();
							$("#progress").width("100%").text("完成注册 3/3");
						} else if (result.status === 0) {
							$("#nicknameError").text(result.info);
							$("#nicknameError").parent().removeClass("has-error");
						} else {
							$("#warning-message").show();
							$("#warning-message").text(result.info);
						}
					},
					type:"post",
					url:"user/addUser.action"
				});
			});
			
		});
	</script>
</body>
</html>
